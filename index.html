<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maze Escape Game</title>
<style>
    body {
        margin: 0;
        background: black;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        flex-direction: column;
    }
    canvas {
        background: #0a0030;
        border: 3px solid lime;
        box-shadow: 0 0 25px lime;
        touch-action: none;
    }
    .controls {
        margin-top: 15px;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-template-rows: auto auto auto;
        gap: 10px;
        justify-content: center;
    }
    .btn {
        background: rgba(0,255,0,0.2);
        border: 2px solid lime;
        border-radius: 12px;
        font-size: 6vw;   /* ch·ªØ to theo m√†n h√¨nh */
        color: white;
        text-align: center;
        line-height: 60px;
        user-select: none;
        cursor: pointer;
        width: 15vw;
        height: 15vw;
        max-width: 70px;
        max-height: 70px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .btn:active {
        background: rgba(0,255,0,0.5);
    }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<!-- N√∫t ƒëi·ªÅu khi·ªÉn ·∫£o -->
<div class="controls">
    <div></div>
    <div class="btn" onclick="moveCommand('w')">‚Üë</div>
    <div></div>
    <div class="btn" onclick="moveCommand('a')">‚Üê</div>
    <div></div>
    <div class="btn" onclick="moveCommand('d')">‚Üí</div>
    <div></div>
    <div class="btn" onclick="moveCommand('s')">‚Üì</div>
    <div></div>
</div>

<audio id="stepSound" src="https://actions.google.com/sounds/v1/foley/footstep_grass.ogg"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const stepSound = document.getElementById("stepSound");

let rows = 20;
let cols = 20;
let tileSize;
let maze = [];
let visited = [];

// Player
let player = { x: 1, y: 1, px: 1, py: 1, moving: false, tx: 1, ty: 1, speed: 0.2, gold: 0 };

// Exit
let exit = { x: cols-2, y: 1 };

// === Resize canvas theo m√†n h√¨nh ===
function resizeCanvas() {
    let screenW = window.innerWidth;
    let screenH = window.innerHeight;

    // Chi·∫øm 90% chi·ªÅu ngang, 70% chi·ªÅu cao
    let canvasSize = Math.min(screenW * 0.9, screenH * 0.7);

    canvas.width = canvasSize;
    canvas.height = canvasSize;

    tileSize = Math.floor(canvas.width / cols);
}
resizeCanvas();
window.addEventListener("resize", () => {
    resizeCanvas();
    drawMaze(); // v·∫Ω l·∫°i khi xoay m√†n h√¨nh
});

// Key input
document.addEventListener("keydown", (e) => moveCommand(e.key.toLowerCase()));

// === Maze generator (DFS) ===
function generateMaze() {
    maze = Array.from({length: rows}, () => Array(cols).fill("#"));
    visited = Array.from({length: rows}, () => Array(cols).fill(false));

    function carve(x, y) {
        visited[y][x] = true;
        maze[y][x] = ".";
        let directions = [{x:0,y:-2},{x:0,y:2},{x:-2,y:0},{x:2,y:0}];
        directions.sort(() => Math.random() - 0.5);
        for (let dir of directions) {
            let nx = x + dir.x;
            let ny = y + dir.y;
            if (ny > 0 && ny < rows-1 && nx > 0 && nx < cols-1 && !visited[ny][nx]) {
                maze[y+dir.y/2][x+dir.x/2] = ".";
                carve(nx, ny);
            }
        }
    }
    carve(1,1);

    maze[exit.y][exit.x] = "E";
    for (let i=0;i<15;i++){
        let gx=Math.floor(Math.random()*cols), gy=Math.floor(Math.random()*rows);
        if(maze[gy][gx]===".") maze[gy][gx]="G";
    }
}

// === Draw Maze ===
function drawMaze() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<rows;y++){
        for(let x=0;x<cols;x++){
            if(maze[y][x]==="#"){ ctx.fillStyle="#222"; ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize);}
            else if(maze[y][x]==="."){ ctx.fillStyle="#111"; ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize);}
            else if(maze[y][x]==="G"){ ctx.fillStyle="gold"; ctx.beginPath(); ctx.arc(x*tileSize+tileSize/2,y*tileSize+tileSize/2,8,0,Math.PI*2); ctx.fill();}
            else if(maze[y][x]==="E"){ ctx.fillStyle="cyan"; ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize);}
        }
    }
    // Player
    ctx.fillStyle="lime";
    ctx.beginPath(); 
    ctx.arc(player.px*tileSize+tileSize/2, player.py*tileSize+tileSize/2, tileSize/3, 0, Math.PI*2); 
    ctx.fill();
}

// === Move Command (slide until wall) ===
function moveCommand(key){
    if (player.moving) return;

    let dx=0, dy=0;
    if(key==="w") dy=-1;
    if(key==="s") dy=1;
    if(key==="a") dx=-1;
    if(key==="d") dx=1;
    if(dx===0 && dy===0) return;

    let nx = player.x;
    let ny = player.y;

    while(maze[ny+dy] && maze[ny+dy][nx+dx] && maze[ny+dy][nx+dx] !== "#"){
        nx += dx;
        ny += dy;
        if (maze[ny][nx]==="G"){ player.gold++; maze[ny][nx]="."; }
        if (maze[ny][nx]==="E"){ alert("üéâ Tho√°t! V√†ng: "+player.gold); document.location.reload(); }
    }

    if(nx!==player.x || ny!==player.y){
        player.tx = nx;
        player.ty = ny;
        player.moving = true;
        stepSound.loop=true;
        stepSound.play();
    }
}

// === Update Player Movement (smooth animation) ===
function updatePlayer(){
    if(player.moving){
        let dx = player.tx - player.px;
        let dy = player.ty - player.py;

        if(Math.abs(dx)>player.speed) player.px += Math.sign(dx)*player.speed;
        else player.px = player.tx;

        if(Math.abs(dy)>player.speed) player.py += Math.sign(dy)*player.speed;
        else player.py = player.ty;

        if(Math.abs(player.px - player.tx)<0.01 && Math.abs(player.py - player.ty)<0.01){
            player.px = player.tx;
            player.py = player.ty;
            player.x = player.tx;
            player.y = player.ty;
            player.moving = false;
            stepSound.pause();
            stepSound.currentTime = 0;
        }
    }
}

// === Game Loop ===
function gameLoop(){
    updatePlayer();
    drawMaze();
    requestAnimationFrame(gameLoop);
}

generateMaze();
gameLoop();
</script>
</body>
</html>
